<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Estabelecimento</title>
    <link rel="stylesheet" href="cad_est.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body id="tela-cadastro-est">
    <div class="box" id="box-cadastro-est">
        <div class="fundo" id="fundo-cad-est">

            <a href="../Menu/menu.html" id="voltar" class="botao">Voltar</a>

            <label for="titulo-cadastro" id="aviso">
                <h1 id="titulo-cadastro">Cadastro de Estabelecimento</h1>
                <p id="texto">Todos os campos com * são obrigatórios</p>
            </label>

            <h2 id="titulo-geral">Informações Gerais</h2>
            <div id="inf-gerais" class="inf">
                <input type="text" id="nome" class="input" placeholder="Nome do Estabelecimento *" required>
                <input type="text" id="cnpj" class="input" placeholder="CNPJ *" required>

                <input list="categorias" id="categoria" class="input" placeholder="Categoria *" required>
                <datalist id="categorias">
                    <option value="Loja">
                    <option value="Restaurante">
                    <option value="Cinema">
                    <option value="Academia">
                    <option value="Shopping">
                </datalist>

            </div>

            <h2 id="titulo-funcionamento">Informações de Funcionamento</h2>
            <div id="inf-funcionamento" class="inf">
                <label for="hora-abertura" class="label-hora">Horário de Abertura *:
                    <input type="time" id="hora-abertura" class="input" required>
                </label>
                <label for="hora-encerramento" class="label-hora">Horário de Encerramento *:
                    <input type="time" id="hora-encerramento" class="input" required>
                </label>
                <div id="semanario">
                    <h3 id="titulo-dias">Dias de Funcionamento: </h3>
                    <label for="segunda">
                        <input type="checkbox" id="segunda" value="segunda" class="check">
                        Segunda-feira
                    </label>
                    <label for="terca">
                        <input type="checkbox" id="terca" value="terca" class="check">
                        Terça-feira
                    </label>
                    <label for="quarta">
                        <input type="checkbox" id="quarta" value="quarta" class="check">
                        Quarta-feira
                    </label>
                    <label for="quinta">
                        <input type="checkbox" id="quinta" value="quinta" class="check">
                        Quinta-feira
                    </label>
                    <label for="sexta">
                        <input type="checkbox" id="sexta" value="sexta" class="check">
                        Sexta-feira
                    </label>
                    <label for="sabado">
                        <input type="checkbox" id="sabado" value="sabado" class="check">
                        Sábado
                    </label>
                    <label for="domingo">
                        <input type="checkbox" id="domingo" value="domingo" class="check">
                        Domingo
                    </label>
                </div>
            </div>

            <h2 id="titulo-endereco">Informações de Endereço</h2>
            <div id="inf-endereco" class="inf">
                <input type="text" id="cep" class="input" placeholder="CEP *" onblur="consultaEndereco()" required>
                <input type="text" id="uf" class="input" placeholder="UF *" required>
                <input type="text" id="cidade" class="input" placeholder="Cidade *" required>
                <input type="text" id="bairro" class="input" placeholder="Bairro *" required>
                <input type="text" id="rua" class="input" placeholder="Rua *" required>
                <input type="number" id="numero" class="input" placeholder="Número">
                <input type="text" id="complemento" class="input" placeholder="Complemento">
            </div>


            <button id="cadastrar" class="botao" onclick="cadastrar()">Cadastrar</button>
        </div>
    </div>

    <!-- Bibliotecas e códigos de terceiros -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.js"></script>

    <!-- Máscaras -->
    <script>$('#cnpj').mask('00.000.000/0000-00', { reverse: true });</script>
    <script>$('#cep').mask('00000-000');</script>
</body>
<script>
    async function envia() {
        const name = document.getElementById("nome").value;
        const cnpj = document.getElementById("cnpj").value;
        const categoria = document.getElementById("categoria").value;
        const opening_time = document.getElementById("hora-abertura").value;
        const closing_time = document.getElementById("hora-encerramento").value;
        const open_on_monday = document.getElementById("segunda").value;
        const open_on_tuesday = document.getElementById("terca").value;
        const open_on_wednesday = document.getElementById("quarta").value;
        const open_on_thursday = document.getElementById("quinta").value;
        const open_on_friday = document.getElementById("sexta").value;
        const open_on_saturday = document.getElementById("sabado").value;
        const open_on_sunday = document.getElementById("domingo").value;
        const zip_code = document.getElementById("cep").value;
        const state = document.getElementById("uf").value;
        const city = document.getElementById("cidade").value;
        const neighborhood = document.getElementById("bairro").value;
        const street = document.getElementById("rua").value;
        const number = document.getElementById("numero").value;
        const complement = document.getElementById("complemento").value;

        const payload = {
            name,
            cnpj,
            description: "",
            picture_url: "",
            background_picture_url: "",
            category_id: "",
            address: {
                city,
                street,
                number,
                neighborhood,
                complement,
                zip_code,
                state,
                country: "Brasil"
            },
            workingTime: {
                open_on_sunday,
                open_on_monday,
                open_on_tuesday,
                open_on_wednesday,
                open_on_thursday,
                open_on_friday,
                open_on_saturday,
                opening_time,
                closing_time
            }
        }

        try {
            const response = await axios.post('http://localhost:3000/api/establishments', payload);
            //window.location.replace('../Menu/menu.html');
        } catch (error) {
            const aux = error.response.data.message;
            alert(aux);
        }
    }
</script>

<script src="../Cadastro_Estabelecimento/validacao.js"></script>
<script src="../Cadastro_Estabelecimento/cep.js"></script>

</html>